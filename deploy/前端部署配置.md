# 前端部署配置（阿里云虚拟主机）

## 📤 部署文件清单

上传以下文件到阿里云虚拟主机 `htdocs/` 目录：

```
dist/
├── index.html          ← 必须
├── pwa/
│   ├── manifest.json   ← 必须
│   └── service-worker.js ← 必须
├── css/
│   └── style.min.css   ← 必须
├── js/
│   ├── data.min.js     ← 必须
│   ├── main.min.js     ← 必须
│   ├── modules.min.js  ← 必须
│   ├── script.min.js   ← 必须
│   └── error-monitor.js ← 必须
└── images/
    ├── icon-192.png    ← 可选（PWA 图标）
    └── icon-512.png    ← 可选（PWA 图标）
```

---

## 🔧 部署前配置

### 1. 修改 API 地址

在 `index.html` 中找到以下代码：

```html
<script>
    window.API_CONFIG = {
        baseURL: window.location.hostname === 'localhost' 
            ? 'http://localhost:3000' 
            : 'https://api.hxfund.cn',
        timeout: 30000
    };
</script>
```

将 `https://api.hxfund.cn` 修改为你的 ECS 服务器 API 地址：

```html
<script>
    window.API_CONFIG = {
        baseURL: 'http://your-ecs-ip:3000',  // 或 https://api.your-domain.com
        timeout: 30000
    };
</script>
```

### 2. 构建生产版本

```bash
# 在项目根目录执行
npm run build
```

---

## 📤 上传方式

### 方式一：FTP 上传（推荐）

1. 下载 FTP 工具（如 FileZilla）
2. 获取虚拟主机 FTP 信息（阿里云控制台 → 虚拟主机 → 管理 → FTP 信息）
3. 连接 FTP 服务器
4. 将 `dist/` 目录所有内容上传到 `htdocs/`

### 方式二：阿里云控制台

1. 登录阿里云虚拟主机控制台
2. 点击"管理"进入管理页面
3. 选择"文件管理"
4. 点击"上传"按钮
5. 选择 `dist/` 目录中的文件上传

---

## ✅ 部署验证

### 1. 访问首页

```
http://hxfund.cn/
```

### 2. 检查资源加载

打开浏览器开发者工具（F12），检查：
- [ ] `index.html` 加载成功（200）
- [ ] `style.min.css` 加载成功（200）
- [ ] 所有 `.min.js` 文件加载成功（200）
- [ ] `pwa/manifest.json` 加载成功（200）
- [ ] `pwa/service-worker.js` 注册成功

### 3. 测试 API 连接

在浏览器控制台执行：

```javascript
fetch(window.API_CONFIG.baseURL + '/api/health')
    .then(r => r.json())
    .then(d => console.log(d))
```

如果看到类似输出，说明 API 连接成功：

```json
{
  "status": "ok",
  "service": "huangshi-genealogy-api",
  "version": "3.3.0"
}
```

---

## ⚠️ 常见问题

### 问题 1：页面空白

**原因**: 资源路径错误
**解决**: 确保所有文件上传到 `htdocs/` 根目录，不是子目录

### 问题 2：API 调用失败

**原因**: CORS 或 API 地址错误
**解决**: 
1. 检查 `index.html` 中的 `API_CONFIG.baseURL`
2. 确保后端 CORS 配置允许前端域名

### 问题 3：PWA 无法使用

**原因**: 缺少 HTTPS
**解决**: 在阿里云控制台申请并配置 SSL 证书

---

## 📊 流量监控

阿里云虚拟主机每月 1G 流量限制。监控方法：

1. 登录阿里云控制台
2. 进入虚拟主机管理页面
3. 查看"流量统计"

**优化建议**:
- 使用压缩文件（已自动压缩）
- 图片使用 WebP 格式
- 启用浏览器缓存（已配置）

---

**更新日期**: 2026 年 2 月 25 日
