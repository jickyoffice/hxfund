# å‰ç«¯éƒ¨ç½² - é˜¿é‡Œäº‘è™šæ‹Ÿä¸»æœº
# æ„å»ºå¹¶ä¸Šä¼ åˆ°é˜¿é‡Œäº‘è™šæ‹Ÿä¸»æœº

name: å‰ç«¯éƒ¨ç½² - é˜¿é‡Œäº‘è™šæ‹Ÿä¸»æœº

on:
  push:
    branches: [ main ]
    paths:
      - 'public/**'
      - 'index.html'
      - 'package.json'
      - 'scripts/build.js'
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

env:
  NODE_VERSION: '18'

jobs:
  build-and-deploy:
    name: æ„å»ºå¹¶éƒ¨ç½²åˆ°é˜¿é‡Œäº‘
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
      
      - name: ğŸŸ¢ è®¾ç½® Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
      
      - name: ğŸ“¦ å®‰è£…ä¾èµ–
        run: npm ci
      
      - name: ğŸ”¨ æ„å»ºç”Ÿäº§ç‰ˆæœ¬
        run: npm run build
        env:
          # ç”Ÿäº§ç¯å¢ƒ API åœ°å€ï¼ˆä» Secrets è¯»å–ï¼‰
          API_BASE_URL: ${{ secrets.API_BASE_URL }}
      
      - name: ğŸ“¤ ä¸Šä¼ åˆ°é˜¿é‡Œäº‘è™šæ‹Ÿä¸»æœº (FTP)
        uses: SamKirkland/FTP-Deploy-Action@v4.3.4
        with:
          server: ${{ secrets.FTP_SERVER }}
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          server-dir: /htdocs/
          local-dir: ./dist/
          protocol: ftps
          exclude: |
            **/.git*
            **/.git*/**
            **/node_modules/**
            **/tests/**
            **.md
      
      - name: âœ… éƒ¨ç½²å®Œæˆ
        run: |
          echo "âœ… å‰ç«¯éƒ¨ç½²å®Œæˆï¼"
          echo "è®¿é—®åœ°å€ï¼šhttps://hxfund.cn"
          echo "API åœ°å€ï¼š${{ secrets.API_BASE_URL }}"
